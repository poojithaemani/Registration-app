<div class="view-students-container">
  <!-- Header with Back and Edit Button -->
  <div class="view-header">
    <div class="header-left">
      <button class="btn-back" (click)="goBack()">‚Üê Back to Students</button>
      <h1 class="page-title">Student Details</h1>
    </div>
    <div class="header-right">
      <button class="btn-edit"
        *ngIf="!isEditMode && !isLoading"
        (click)="enableEditMode()"
      >
        ‚úèÔ∏è Edit
      </button>
      <div *ngIf="isEditMode" class="action-buttons">
        <button class="btn-save" (click)="saveChanges()" [disabled]="isSaving">
          {{ isSaving ? "Saving..." : "‚úì Save Changes" }}
        </button>
        <button class="btn-cancel" (click)="cancelEdit()">‚úï Cancel</button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading student details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-alert">
    <span class="error-icon">‚ö†Ô∏è</span>
    <span>{{ error }}</span>
  </div>

  <!-- Form Content -->
  <form
    *ngIf="!isLoading && student"
    [formGroup]="studentForm"
    class="student-form"
  >
    <!-- Child Information Section -->
    <section class="form-section">
      <h2 class="section-title">üëß Child Information</h2>
      <div class="form-grid">
        <div class="form-group">
          <label
            >First Name<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="childFirstName"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('childFirstName')"
          />
          <div *ngIf="isFieldInvalid('childFirstName')" class="error-message">
            {{ getFieldErrorMessage('childFirstName') }}
          </div>
        </div>

        <div class="form-group">
          <label>Middle Name</label>
          <input
            type="text"
            formControlName="childMiddleName"
            class="form-control"
          />
          <div *ngIf="isFieldInvalid('childMiddleName')" class="error-message">
            {{ getFieldErrorMessage("childMiddleName") }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Last Name<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="childLastName"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('childLastName')"
          />
          <div *ngIf="isFieldInvalid('childLastName')" class="error-message">
            {{ getFieldErrorMessage('childLastName') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Gender<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <select
            formControlName="gender"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('gender')"
          >
            <option value="">Select Gender</option>
            <option *ngFor="let option of genderOptions" [value]="option">
              {{ option }}
            </option>
          </select>
          <div *ngIf="isFieldInvalid('gender')" class="error-message">
            {{ getFieldErrorMessage('gender') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Date of Birth<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="date"
            formControlName="dateOfBirth"
            class="form-control"
            [min]="'2000-01-01'"
            [max]="todayDate.toISOString().split('T')[0]"
            [class.is-invalid]="isFieldInvalid('dateOfBirth')"
          />
          <div *ngIf="isFieldInvalid('dateOfBirth')" class="error-message">
            {{ getFieldErrorMessage('dateOfBirth') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Place of Birth<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="placeOfBirth"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('placeOfBirth')"
          />
          <div *ngIf="isFieldInvalid('placeOfBirth')" class="error-message">
            {{ getFieldErrorMessage('placeOfBirth') }}
          </div>
        </div>
      </div>
    </section>

    <!-- Parent/Guardian Information Section -->
    <section class="form-section">
      <h2 class="section-title">üë®‚Äçüë©‚Äçüëß Parent/Guardian Information</h2>
      <div class="form-grid">
        <div class="form-group">
          <label
            >First Name<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="parentFirstName"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('parentFirstName')"
          />
          <div *ngIf="isFieldInvalid('parentFirstName')" class="error-message">
            {{ getFieldErrorMessage('parentFirstName') }}
          </div>
        </div>

        <div class="form-group">
          <label>Middle Name</label>
          <input
            type="text"
            formControlName="parentMiddleName"
            class="form-control"
          />
          <div *ngIf="isFieldInvalid('parentMiddleName')" class="error-message">
            {{ getFieldErrorMessage("parentMiddleName") }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Last Name<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="parentLastName"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('parentLastName')"
          />
          <div *ngIf="isFieldInvalid('parentLastName')" class="error-message">
            {{ getFieldErrorMessage('parentLastName') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Email<span *ngIf="isEditMode" class="required-star">*</span></label
          >
          <input
            type="email"
            formControlName="parentEmail"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('parentEmail')"
          />
          <div *ngIf="isFieldInvalid('parentEmail')" class="error-message">
            {{ getFieldErrorMessage("parentEmail") }}
          </div>
        </div>

        <div class="form-group form-group-full">
          <label
            >Address Line 1<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="parentAddress1"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('parentAddress1')"
          />
          <div *ngIf="isFieldInvalid('parentAddress1')" class="error-message">
            {{ getFieldErrorMessage('parentAddress1') }}
          </div>
        </div>

        <div class="form-group form-group-full">
          <label>Address Line 2</label>
          <input
            type="text"
            formControlName="parentAddress2"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label
            >City<span *ngIf="isEditMode" class="required-star">*</span></label
          >
          <input
            type="text"
            formControlName="parentCity"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('parentCity')"
          />
          <div *ngIf="isFieldInvalid('parentCity')" class="error-message">
            {{ getFieldErrorMessage('parentCity') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >State<span *ngIf="isEditMode" class="required-star">*</span></label
          >
          <select
            formControlName="parentState"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('parentState')"
          >
            <option value="">Select State</option>
            <option *ngFor="let state of usStates" [value]="state.name">
              {{ state.name }}
            </option>
          </select>
          <div *ngIf="isFieldInvalid('parentState')" class="error-message">
            {{ getFieldErrorMessage('parentState') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Country<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="parentCountry"
            class="form-control"
            [readonly]="!isEditMode"
            [class.is-invalid]="isFieldInvalid('parentCountry')"
          />
          <div *ngIf="isFieldInvalid('parentCountry')" class="error-message">
            {{ getFieldErrorMessage('parentCountry') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Zip Code<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="parentZipCode"
            class="form-control"
            (keypress)="validationService.keyPressNumbers($event, 5)"
            (input)="formatZipCode($event, 'parentZipCode')"
            [class.is-invalid]="isFieldInvalid('parentZipCode')"
          />
          <div *ngIf="isFieldInvalid('parentZipCode')" class="error-message">
            {{ getFieldErrorMessage("parentZipCode") }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Phone Type<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <select
            formControlName="parentPhoneType"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('parentPhoneType')"
          >
            <option value="">Select Phone Type</option>
            <option *ngFor="let option of phoneTypeOptions" [value]="option">
              {{ option }}
            </option>
          </select>
          <div *ngIf="isFieldInvalid('parentPhoneType')" class="error-message">
            {{ getFieldErrorMessage('parentPhoneType') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Phone Number<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="parentPhoneNumber"
            class="form-control"
            (keypress)="validationService.keyPressNumbers($event, 10)"
            (input)="formatPhoneNumber($event, 'parentPhoneNumber')"
            [class.is-invalid]="isFieldInvalid('parentPhoneNumber')"
          />
          <div
            *ngIf="isFieldInvalid('parentPhoneNumber')"
            class="error-message"
          >
            {{ getFieldErrorMessage("parentPhoneNumber") }}
          </div>
        </div>

        <div class="form-group">
          <label>Alternate Phone Type</label>
          <select
            formControlName="parentAlternatePhoneType"
            class="form-control"
          >
            <option value="">Select Alternate Phone Type</option>
            <option *ngFor="let option of phoneTypeOptions" [value]="option">
              {{ option }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>Alternate Phone Number</label>
          <input
            type="tel"
            formControlName="parentAlternatePhoneNumber"
            class="form-control"
            (keypress)="validationService.keyPressNumbers($event, 10)"
            (input)="formatPhoneNumber($event, 'parentAlternatePhoneNumber')"
            [class.is-invalid]="isFieldInvalid('parentAlternatePhoneNumber')"
          />
          <div
            *ngIf="isFieldInvalid('parentAlternatePhoneNumber')"
            class="error-message"
          >
            {{ getFieldErrorMessage("parentAlternatePhoneNumber") }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Relationship
            <span *ngIf="isEditMode" class="required-star">*</span></label
          >
          <select
            formControlName="parentRelationship"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('parentRelationship')"
          >
            <option value="">Select Relationship</option>
            <option value="Mother">Mother</option>
            <option value="Father">Father</option>
            <option value="Guardian">Guardian</option>
            <option value="Other">Other</option>
          </select>
          <div
            *ngIf="isFieldInvalid('parentRelationship')"
            class="error-message"
          >
            {{ getFieldErrorMessage('parentRelationship') }}
          </div>
        </div>
      </div>
    </section>

    <!-- Medical Information Section -->
    <section class="form-section">
      <h2 class="section-title">üè• Medical Information</h2>
      <div class="form-grid">
        <div class="form-group">
          <label
            >Physician First Name<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="physicianFirstName"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('physicianFirstName')"
          />
          <div
            *ngIf="isFieldInvalid('physicianFirstName')"
            class="error-message"
          >
            {{ getFieldErrorMessage("physicianFirstName") }}
          </div>
        </div>
        <div class="form-group">
          <label>Physician Middle Name</label>
          <input
            type="text"
            formControlName="physicianMiddleName"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('physicianMiddleName')"
          />
          <div
            *ngIf="isFieldInvalid('physicianMiddleName')"
            class="error-message"
          >
            {{ getFieldErrorMessage("physicianMiddleName") }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Physician Last Name<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="physicianLastName"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('physicianLastName')"
          />
          <div
            *ngIf="isFieldInvalid('physicianLastName')"
            class="error-message"
          >
            {{ getFieldErrorMessage("physicianLastName") }}
          </div>
        </div>

        <div class="form-group form-group-full">
          <label
            >Address Line 1<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="medicalAddress1"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('medicalAddress1')"
          />
          <div *ngIf="isFieldInvalid('medicalAddress1')" class="error-message">
            {{ getFieldErrorMessage('medicalAddress1') }}
          </div>
        </div>

        <div class="form-group form-group-full">
          <label>Address Line 2</label>
          <input
            type="text"
            formControlName="medicalAddress2"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label
            >City<span *ngIf="isEditMode" class="required-star">*</span></label
          >
          <input
            type="text"
            formControlName="medicalCity"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('medicalCity')"
          />
          <div *ngIf="isFieldInvalid('medicalCity')" class="error-message">
            {{ getFieldErrorMessage('medicalCity') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >State<span *ngIf="isEditMode" class="required-star">*</span></label
          >
          <select
            formControlName="medicalState"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('medicalState')"
          >
            <option value="">Select State</option>
            <option *ngFor="let state of usStates" [value]="state.name">
              {{ state.name }}
            </option>
          </select>
          <div *ngIf="isFieldInvalid('medicalState')" class="error-message">
            {{ getFieldErrorMessage('medicalState') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Country<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="medicalCountry"
            class="form-control"
            [readonly]="!isEditMode"
            [class.is-invalid]="isFieldInvalid('medicalCountry')"
          />
          <div *ngIf="isFieldInvalid('medicalCountry')" class="error-message">
            {{ getFieldErrorMessage('medicalCountry') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Zip Code<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="medicalZipCode"
            class="form-control"
            (keypress)="validationService.keyPressNumbers($event, 5)"
            (input)="formatZipCode($event, 'medicalZipCode')"
            [class.is-invalid]="isFieldInvalid('medicalZipCode')"
          />
          <div *ngIf="isFieldInvalid('medicalZipCode')" class="error-message">
            {{ getFieldErrorMessage("medicalZipCode") }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Phone Type<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <select
            formControlName="medicalPhoneType"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('medicalPhoneType')"
          >
            <option value="">Select Phone Type</option>
            <option *ngFor="let option of phoneTypeOptions" [value]="option">
              {{ option }}
            </option>
          </select>
          <div *ngIf="isFieldInvalid('medicalPhoneType')" class="error-message">
            {{ getFieldErrorMessage('medicalPhoneType') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Phone Number<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="tel"
            formControlName="medicalPhoneNumber"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('medicalPhoneNumber')"
          />
          <div
            *ngIf="isFieldInvalid('medicalPhoneNumber')"
            class="error-message"
          >
            {{ getFieldErrorMessage('medicalPhoneNumber') }}
          </div>
        </div>
        <div class="form-group">
          <label>Alternate Phone Type</label>
          <select
            formControlName="medicalAlternatePhoneType"
            class="form-control"
          >
            <option value="">Select Alternate Phone Type</option>
            <option *ngFor="let option of phoneTypeOptions" [value]="option">
              {{ option }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>Alternate Phone Number</label>
          <input
            type="tel"
            formControlName="medicalAlternatePhoneNumber"
            class="form-control"
            (keypress)="validationService.keyPressNumbers($event, 10)"
            (input)="formatPhoneNumber($event, 'medicalAlternatePhoneNumber')"
            [class.is-invalid]="isFieldInvalid('medicalAlternatePhoneNumber')"
          />
          <div
            *ngIf="isFieldInvalid('medicalAlternatePhoneNumber')"
            class="error-message"
          >
            {{ getFieldErrorMessage('medicalAlternatePhoneNumber') }}
          </div>
        </div>
      </div>
    </section>

    <!-- Care Facility Section -->
    <section class="form-section">
      <h2 class="section-title">üè¢ Care Facility Information</h2>
      <div class="form-grid">
        <div class="form-group">
          <label
            >Emergency Contact Name<span
              *ngIf="isEditMode"
              class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="emergencyContactName"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('emergencyContactName')"
          />
          <div
            *ngIf="isFieldInvalid('emergencyContactName')"
            class="error-message"
          >
            {{ getFieldErrorMessage('emergencyContactName') }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Emergency Phone Number<span
              *ngIf="isEditMode"
              class="required-star"
              >*</span
            ></label
          >
          <input
            type="tel"
            formControlName="emergencyPhoneNumber"
            class="form-control"
            (keypress)="validationService.keyPressNumbers($event, 10)"
            (input)="formatPhoneNumber($event, 'emergencyPhoneNumber')"
            [class.is-invalid]="isFieldInvalid('emergencyPhoneNumber')"
          />
          <div
            *ngIf="isFieldInvalid('emergencyPhoneNumber')"
            class="error-message"
          >
            {{ getFieldErrorMessage('emergencyPhoneNumber') }}
          </div>
        </div>

        <div class="form-group form-group-full">
          <label
            >Address Line 1<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="careFacilityAddress1"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('careFacilityAddress1')"
          />
          <div
            *ngIf="isFieldInvalid('careFacilityAddress1')"
            class="error-message"
          >
            Address is required
          </div>
        </div>

        <div class="form-group form-group-full">
          <label>Address Line 2</label>
          <input
            type="text"
            formControlName="careFacilityAddress2"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label
            >City<span *ngIf="isEditMode" class="required-star">*</span></label
          >
          <input
            type="text"
            formControlName="careFacilityCity"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('careFacilityCity')"
          />
          <div *ngIf="isFieldInvalid('careFacilityCity')" class="error-message">
            City is required
          </div>
        </div>

        <div class="form-group">
          <label
            >State<span *ngIf="isEditMode" class="required-star">*</span></label
          >
          <select
            formControlName="careFacilityState"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('careFacilityState')"
          >
            <option value="">Select State</option>
            <option *ngFor="let state of usStates" [value]="state.name">
              {{ state.name }}
            </option>
          </select>
          <div
            *ngIf="isFieldInvalid('careFacilityState')"
            class="error-message"
          >
            State is required
          </div>
        </div>

        <div class="form-group">
          <label
            >Country<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="careFacilityCountry"
            class="form-control"
            [readonly]="!isEditMode"
            [class.is-invalid]="isFieldInvalid('careFacilityCountry')"
          />
          <div
            *ngIf="isFieldInvalid('careFacilityCountry')"
            class="error-message"
          >
            Country is required
          </div>
        </div>

        <div class="form-group">
          <label
            >Zip Code<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <input
            type="text"
            formControlName="careFacilityZipCode"
            class="form-control"
            (keypress)="validationService.keyPressNumbers($event, 5)"
            (input)="formatZipCode($event, 'careFacilityZipCode')"
            [class.is-invalid]="isFieldInvalid('careFacilityZipCode')"
          />
          <div
            *ngIf="isFieldInvalid('careFacilityZipCode')"
            class="error-message"
          >
            {{ getFieldErrorMessage("careFacilityZipCode") }}
          </div>
        </div>

        <div class="form-group">
          <label
            >Phone Type<span *ngIf="isEditMode" class="required-star"
              >*</span
            ></label
          >
          <select
            formControlName="careFacilityPhoneType"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('careFacilityPhoneType')"
          >
            <option value="">Select Phone Type</option>
            <option *ngFor="let option of phoneTypeOptions" [value]="option">
              {{ option }}
            </option>
          </select>
          <div
            *ngIf="isFieldInvalid('careFacilityPhoneType')"
            class="error-message"
          >
            Phone type is required
          </div>
        </div>
      </div>
    </section>

    <!-- Enrollment Program Details Section (Read-Only) -->
    <section class="form-section enrollment-section">
      <h2 class="section-title">üìã Enrollment Program Details (Read-Only)</h2>
      <div class="form-grid">
        <div class="form-group">
          <label>Program Type</label>
          <input
            type="text"
            formControlName="programType"
            class="form-control"
            [disabled]="true"
          />
        </div>

        <div class="form-group">
          <label>Room Type</label>
          <input
            type="text"
            formControlName="roomType"
            class="form-control"
            [disabled]="true"
          />
        </div>

        <div class="form-group">
          <label>Plan Type</label>
          <input
            type="text"
            formControlName="planType"
            class="form-control"
            [disabled]="true"
          />
        </div>

        <div class="form-group">
          <label>Enrollment Status</label>
          <input
            type="text"
            formControlName="enrollmentStatus"
            class="form-control"
            [disabled]="true"
          />
        </div>
      </div>
    </section>
  </form>
</div>
