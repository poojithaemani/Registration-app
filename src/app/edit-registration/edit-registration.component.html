<div class="edit-registration-container">
  <!-- Success Snackbar -->
  <div *ngIf="successMessage" class="snackbar snackbar-success">
    <span>{{ successMessage }}</span>
    <button
      type="button"
      class="snackbar-close"
      (click)="successMessage = ''"
      aria-label="Close"
    >
      ✕
    </button>
  </div>

  <div class="edit-registration-card">
    <!-- Header with Search and Controls -->
    <div class="header-section">
      <div class="header-top">
        <div class="header-left">
          <h1 class="heading">Student Registration Details</h1>
          <input
            type="text"
            placeholder="Search fields..."
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearch(searchTerm)"
            class="search-bar"
          />
        </div>
        <div class="header-right">
          <button
            type="button"
            class="back-to-login"
            (click)="navigateToStudents()"
          >
            ← Back to Students
          </button>
          <button
            *ngIf="!isEditMode"
            type="button"
            class="btn-edit"
            (click)="enableEditMode()"
          >
            ✏️ Edit Details
          </button>
          <button
            *ngIf="isEditMode"
            type="button"
            class="btn-edit"
            [disabled]="true"
            style="opacity: 0.6"
          >
            ✏️ Edit Details
          </button>
        </div>
      </div>
    </div>

    <!-- Form -->
    <form [formGroup]="registrationForm" *ngIf="!loading">
      <!-- Child Info Section -->
      <div class="form-section">
        <h2 class="section-title">Child Information</h2>
        <div class="form-row">
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('childFirstName') }"
          >
            <label
              >First Name
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="childFirstName"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('childFirstName')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'childFirstName')"
            />
            <div *ngIf="isFieldInvalid('childFirstName')" class="error-message">
              {{ getFieldErrorMessage("childFirstName") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('childMiddleName') }"
          >
            <label>Middle Name</label>
            <input
              type="text"
              formControlName="childMiddleName"
              class="form-control"
              [readonly]="!isEditMode"
            />
            <div
              *ngIf="isFieldInvalid('childMiddleName')"
              class="error-message"
            >
              {{ getFieldErrorMessage("childMiddleName") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('childLastName') }"
          >
            <label
              >Last Name
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="childLastName"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('childLastName')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'childLastName')"
            />
            <div *ngIf="isFieldInvalid('childLastName')" class="error-message">
              {{ getFieldErrorMessage("childLastName") }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('gender') }"
          >
            <label
              >Gender
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <select
              formControlName="gender"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('gender')"
              [disabled]="!isEditMode"
            >
              <option value="">Select Gender</option>
              <option *ngFor="let option of genderOptions" [value]="option">
                {{ option }}
              </option>
            </select>
            <div *ngIf="isFieldInvalid('gender')" class="error-message">
              {{ getFieldErrorMessage("gender") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('dateOfBirth') }"
          >
            <label
              >Date of Birth
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="date"
              formControlName="dateOfBirth"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('dateOfBirth')"
              [disabled]="!isEditMode"
            />
            <div *ngIf="isFieldInvalid('dateOfBirth')" class="error-message">
              {{ getFieldErrorMessage("dateOfBirth") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('placeOfBirth') }"
          >
            <label
              >Place of Birth
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="placeOfBirth"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('placeOfBirth')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'placeOfBirth')"
            />
            <div *ngIf="isFieldInvalid('placeOfBirth')" class="error-message">
              {{ getFieldErrorMessage("placeOfBirth") }}
            </div>
          </div>
        </div>
      </div>

      <!-- Parent/Guardian Info Section -->
      <div class="form-section">
        <h2 class="section-title">Parent/Guardian Information</h2>
        <div class="form-row">
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('parentFirstName') }"
          >
            <label
              >First Name
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="parentFirstName"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('parentFirstName')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'parentFirstName')"
            />
            <div
              *ngIf="isFieldInvalid('parentFirstName')"
              class="error-message"
            >
              {{ getFieldErrorMessage("parentFirstName") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('parentMiddleName') }"
          >
            <label>Middle Name</label>
            <input
              type="text"
              formControlName="parentMiddleName"
              class="form-control"
              [readonly]="!isEditMode"
            />
            <div
              *ngIf="isFieldInvalid('parentMiddleName')"
              class="error-message"
            >
              {{ getFieldErrorMessage("parentMiddleName") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('parentLastName') }"
          >
            <label
              >Last Name
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="parentLastName"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('parentLastName')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'parentLastName')"
            />
            <div *ngIf="isFieldInvalid('parentLastName')" class="error-message">
              {{ getFieldErrorMessage("parentLastName") }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('relationship') }"
          >
            <label
              >Relationship
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <select
              formControlName="relationship"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('relationship')"
              [disabled]="!isEditMode"
            >
              <option value="">Select Relationship</option>
              <option
                *ngFor="let option of relationshipOptions"
                [value]="option"
              >
                {{ option }}
              </option>
            </select>
            <div *ngIf="isFieldInvalid('relationship')" class="error-message">
              {{ getFieldErrorMessage("relationship") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('parentEmail') }"
          >
            <label
              >Email
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="email"
              formControlName="parentEmail"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('parentEmail')"
              [readonly]="!isEditMode"
            />
            <div *ngIf="isFieldInvalid('parentEmail')" class="error-message">
              {{ getFieldErrorMessage("parentEmail") }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div
            class="form-group full-width"
            [ngClass]="{ highlighted: isHighlighted('parentAddress1') }"
          >
            <label
              >Address Line 1
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="parentAddress1"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('parentAddress1')"
              [readonly]="!isEditMode"
            />
            <div *ngIf="isFieldInvalid('parentAddress1')" class="error-message">
              {{ getFieldErrorMessage("parentAddress1") }}
            </div>
          </div>
          <div
            class="form-group full-width"
            [ngClass]="{ highlighted: isHighlighted('parentAddress2') }"
          >
            <label>Address Line 2</label>
            <input
              type="text"
              formControlName="parentAddress2"
              class="form-control"
              [readonly]="!isEditMode"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Country</label>
            <input
              type="text"
              formControlName="parentCountry"
              class="form-control"
              [disabled]="true"
            />
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('parentState') }"
          >
            <label
              >State
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <select
              formControlName="parentState"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('parentState')"
              [disabled]="!isEditMode"
            >
              <option value="">Select State</option>
              <option *ngFor="let state of usStates" [value]="state.name">
                {{ state.name }}
              </option>
            </select>
            <div *ngIf="isFieldInvalid('parentState')" class="error-message">
              {{ getFieldErrorMessage("parentState") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('parentCity') }"
          >
            <label
              >City
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="parentCity"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('parentCity')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'parentCity')"
            />
            <div *ngIf="isFieldInvalid('parentCity')" class="error-message">
              {{ getFieldErrorMessage("parentCity") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('parentZipCode') }"
          >
            <label
              >Zip Code
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="parentZipCode"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('parentZipCode')"
              [readonly]="!isEditMode"
              (input)="sanitizeZipInput($event, 'parentZipCode')"
            />
            <div *ngIf="isFieldInvalid('parentZipCode')" class="error-message">
              {{ getFieldErrorMessage("parentZipCode") }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('parentPhoneType') }"
          >
            <label
              >Phone Type
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <select
              formControlName="parentPhoneType"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('parentPhoneType')"
              [disabled]="!isEditMode"
            >
              <option value="">Select Phone Type</option>
              <option *ngFor="let option of phoneTypeOptions" [value]="option">
                {{ option }}
              </option>
            </select>
            <div
              *ngIf="isFieldInvalid('parentPhoneType')"
              class="error-message"
            >
              {{ getFieldErrorMessage("parentPhoneType") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('parentPhoneNumber') }"
          >
            <label
              >Phone Number
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <div class="phone-input-wrapper">
              <span class="country-code">+1 (US)</span>
              <input
                type="text"
                formControlName="parentPhoneNumber"
                class="form-control"
                placeholder="(555) 555-5555"
                maxlength="14"
                (input)="sanitizePhoneInput($event, 'parentPhoneNumber')"
                (keypress)="onPhoneKeypress($event, 'parentPhoneNumber')"
                [class.is-invalid]="isFieldInvalid('parentPhoneNumber')"
                [readonly]="!isEditMode"
              />
            </div>
            <div
              *ngIf="isFieldInvalid('parentPhoneNumber')"
              class="error-message"
            >
              {{ getFieldErrorMessage("parentPhoneNumber") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{
              highlighted: isHighlighted('parentAlternatePhoneType')
            }"
          >
            <label>Alternate Phone Type</label>
            <select
              formControlName="parentAlternatePhoneType"
              class="form-control"
              [disabled]="!isEditMode"
            >
              <option value="">Select Phone Type</option>
              <option *ngFor="let option of phoneTypeOptions" [value]="option">
                {{ option }}
              </option>
            </select>
          </div>
          <div
            class="form-group"
            [ngClass]="{
              highlighted: isHighlighted('parentAlternatePhoneNumber')
            }"
          >
            <label>Alternate Phone Number</label>
            <input
              type="text"
              formControlName="parentAlternatePhoneNumber"
              class="form-control"
              placeholder="(555) 555-5555"
              maxlength="14"
              (input)="sanitizePhoneInput($event, 'parentAlternatePhoneNumber')"
              (keypress)="onPhoneKeypress($event, 'parentAlternatePhoneNumber')"
              [readonly]="!isEditMode"
            />
          </div>
        </div>
      </div>

      <!-- Medical Info Section -->
      <div class="form-section">
        <h2 class="section-title">Medical Information</h2>
        <div class="form-row">
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('physicianFirstName') }"
          >
            <label
              >Physician First Name
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="physicianFirstName"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('physicianFirstName')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'physicianFirstName')"
            />
            <div
              *ngIf="isFieldInvalid('physicianFirstName')"
              class="error-message"
            >
              {{ getFieldErrorMessage("physicianFirstName") }}
            </div>
          </div>
          <div class="form-group">
            <label>Physician Middle Name</label>
            <input
              type="text"
              formControlName="physicianMiddleName"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('physicianMiddleName')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'physicianMiddleName')"
            />
            <div
              *ngIf="isFieldInvalid('physicianMiddleName')"
              class="error-message"
            >
              {{ getFieldErrorMessage("physicianMiddleName") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('physicianLastName') }"
          >
            <label
              >Physician Last Name
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="physicianLastName"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('physicianLastName')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'physicianLastName')"
            />
            <div
              *ngIf="isFieldInvalid('physicianLastName')"
              class="error-message"
            >
              {{ getFieldErrorMessage("physicianLastName") }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div
            class="form-group full-width"
            [ngClass]="{ highlighted: isHighlighted('medicalAddress1') }"
          >
            <label
              >Address Line 1
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="medicalAddress1"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('medicalAddress1')"
              [readonly]="!isEditMode"
            />
            <div
              *ngIf="isFieldInvalid('medicalAddress1')"
              class="error-message"
            >
              {{ getFieldErrorMessage("medicalAddress1") }}
            </div>
          </div>
          <div
            class="form-group full-width"
            [ngClass]="{ highlighted: isHighlighted('medicalAddress2') }"
          >
            <label>Address Line 2</label>
            <input
              type="text"
              formControlName="medicalAddress2"
              class="form-control"
              [readonly]="!isEditMode"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Country</label>
            <input
              type="text"
              formControlName="medicalCountry"
              class="form-control"
              [disabled]="true"
            />
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('medicalState') }"
          >
            <label
              >State
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <select
              formControlName="medicalState"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('medicalState')"
              [disabled]="!isEditMode"
            >
              <option value="">Select State</option>
              <option *ngFor="let state of usStates" [value]="state.name">
                {{ state.name }}
              </option>
            </select>
            <div *ngIf="isFieldInvalid('medicalState')" class="error-message">
              {{ getFieldErrorMessage("medicalState") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('medicalCity') }"
          >
            <label
              >City
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="medicalCity"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('medicalCity')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'medicalCity')"
            />
            <div *ngIf="isFieldInvalid('medicalCity')" class="error-message">
              {{ getFieldErrorMessage("medicalCity") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('medicalZipCode') }"
          >
            <label
              >Zip Code
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="medicalZipCode"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('medicalZipCode')"
              [readonly]="!isEditMode"
              (input)="sanitizeZipInput($event, 'medicalZipCode')"
            />
            <div *ngIf="isFieldInvalid('medicalZipCode')" class="error-message">
              {{ getFieldErrorMessage("medicalZipCode") }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('medicalPhoneType') }"
          >
            <label
              >Phone Type
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <select
              formControlName="medicalPhoneType"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('medicalPhoneType')"
              [disabled]="!isEditMode"
            >
              <option value="">Select Phone Type</option>
              <option *ngFor="let option of phoneTypeOptions" [value]="option">
                {{ option }}
              </option>
            </select>
            <div
              *ngIf="isFieldInvalid('medicalPhoneType')"
              class="error-message"
            >
              {{ getFieldErrorMessage("medicalPhoneType") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('medicalPhoneNumber') }"
          >
            <label
              >Phone Number
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <div class="phone-input-wrapper">
              <span class="country-code">+1 (US)</span>
              <input
                type="text"
                formControlName="medicalPhoneNumber"
                class="form-control"
                placeholder="(555) 555-5555"
                maxlength="14"
                (input)="sanitizePhoneInput($event, 'medicalPhoneNumber')"
                (keypress)="onPhoneKeypress($event, 'medicalPhoneNumber')"
                [class.is-invalid]="isFieldInvalid('medicalPhoneNumber')"
                [readonly]="!isEditMode"
              />
            </div>
            <div
              *ngIf="isFieldInvalid('medicalPhoneNumber')"
              class="error-message"
            >
              {{ getFieldErrorMessage("medicalPhoneNumber") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{
              highlighted: isHighlighted('medicalAlternatePhoneType')
            }"
          >
            <label>Alternate Phone Type</label>
            <select
              formControlName="medicalAlternatePhoneType"
              class="form-control"
              [disabled]="!isEditMode"
            >
              <option value="">Select Phone Type</option>
              <option *ngFor="let option of phoneTypeOptions" [value]="option">
                {{ option }}
              </option>
            </select>
          </div>
          <div
            class="form-group"
            [ngClass]="{
              highlighted: isHighlighted('medicalAlternatePhoneNumber')
            }"
          >
            <label>Alternate Phone Number</label>
            <input
              type="text"
              formControlName="medicalAlternatePhoneNumber"
              class="form-control"
              placeholder="(555) 555-5555"
              maxlength="14"
              (input)="
                sanitizePhoneInput($event, 'medicalAlternatePhoneNumber')
              "
              (keypress)="
                onPhoneKeypress($event, 'medicalAlternatePhoneNumber')
              "
              [readonly]="!isEditMode"
            />
          </div>
        </div>
      </div>

      <!-- Care Facility Info Section -->
      <div class="form-section">
        <h2 class="section-title">Care Facility Information</h2>
        <div class="form-row">
          <div
            class="form-group full-width"
            [ngClass]="{ highlighted: isHighlighted('emergencyContactName') }"
          >
            <label
              >Emergency Contact Name
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="emergencyContactName"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('emergencyContactName')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'emergencyContactName')"
            />
            <div
              *ngIf="isFieldInvalid('emergencyContactName')"
              class="error-message"
            >
              {{ getFieldErrorMessage("emergencyContactName") }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div
            class="form-group full-width"
            [ngClass]="{ highlighted: isHighlighted('careFacilityAddress1') }"
          >
            <label
              >Address Line 1
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="careFacilityAddress1"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('careFacilityAddress1')"
              [readonly]="!isEditMode"
            />
            <div
              *ngIf="isFieldInvalid('careFacilityAddress1')"
              class="error-message"
            >
              {{ getFieldErrorMessage("careFacilityAddress1") }}
            </div>
          </div>
          <div
            class="form-group full-width"
            [ngClass]="{ highlighted: isHighlighted('careFacilityAddress2') }"
          >
            <label>Address Line 2</label>
            <input
              type="text"
              formControlName="careFacilityAddress2"
              class="form-control"
              [readonly]="!isEditMode"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Country</label>
            <input
              type="text"
              formControlName="careFacilityCountry"
              class="form-control"
              [disabled]="true"
            />
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('careFacilityState') }"
          >
            <label
              >State
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <select
              formControlName="careFacilityState"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('careFacilityState')"
              [disabled]="!isEditMode"
            >
              <option value="">Select State</option>
              <option *ngFor="let state of usStates" [value]="state.name">
                {{ state.name }}
              </option>
            </select>
            <div
              *ngIf="isFieldInvalid('careFacilityState')"
              class="error-message"
            >
              {{ getFieldErrorMessage("careFacilityState") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('careFacilityCity') }"
          >
            <label
              >City
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="careFacilityCity"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('careFacilityCity')"
              [readonly]="!isEditMode"
              (input)="sanitizeNameInput($event, 'careFacilityCity')"
            />
            <div
              *ngIf="isFieldInvalid('careFacilityCity')"
              class="error-message"
            >
              {{ getFieldErrorMessage("careFacilityCity") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('careFacilityZipCode') }"
          >
            <label
              >Zip Code
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <input
              type="text"
              formControlName="careFacilityZipCode"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('careFacilityZipCode')"
              [readonly]="!isEditMode"
              (input)="sanitizeZipInput($event, 'careFacilityZipCode')"
            />
            <div
              *ngIf="isFieldInvalid('careFacilityZipCode')"
              class="error-message"
            >
              {{ getFieldErrorMessage("careFacilityZipCode") }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('careFacilityPhoneType') }"
          >
            <label
              >Phone Type
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <select
              formControlName="careFacilityPhoneType"
              class="form-control"
              [class.is-invalid]="isFieldInvalid('careFacilityPhoneType')"
              [disabled]="!isEditMode"
            >
              <option value="">Select Phone Type</option>
              <option *ngFor="let option of phoneTypeOptions" [value]="option">
                {{ option }}
              </option>
            </select>
            <div
              *ngIf="isFieldInvalid('careFacilityPhoneType')"
              class="error-message"
            >
              {{ getFieldErrorMessage("careFacilityPhoneType") }}
            </div>
          </div>
          <div
            class="form-group"
            [ngClass]="{ highlighted: isHighlighted('emergencyPhoneNumber') }"
          >
            <label
              >Emergency Contact Phone Number
              <span *ngIf="isEditMode" class="required-star">*</span></label
            >
            <div class="phone-input-wrapper">
              <span class="country-code">+1 (US)</span>
              <input
                type="text"
                formControlName="emergencyPhoneNumber"
                class="form-control"
                placeholder="(555) 555-5555"
                maxlength="14"
                (input)="sanitizePhoneInput($event, 'emergencyPhoneNumber')"
                (keypress)="onPhoneKeypress($event, 'emergencyPhoneNumber')"
                [class.is-invalid]="isFieldInvalid('emergencyPhoneNumber')"
                [readonly]="!isEditMode"
              />
            </div>
            <div
              *ngIf="isFieldInvalid('emergencyPhoneNumber')"
              class="error-message"
            >
              {{ getFieldErrorMessage("emergencyPhoneNumber") }}
            </div>
          </div>
        </div>
      </div>

      <!-- Enrollment Program Details Section (Read-only) -->
      <div class="form-section">
        <h2 class="section-title">Enrollment Program Details</h2>
        <div class="form-row">
          <div class="form-group">
            <label>Program Type</label>
            <select
              formControlName="programType"
              class="form-control"
              [disabled]="!isEditMode"
            >
              <option value="">Select Program</option>
              <option
                *ngFor="let p of programTypeOptions"
                [value]="p.programid"
              >
                {{ formatDropdownText(p.programname) }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label>Room Type</label>
            <select
              formControlName="roomType"
              class="form-control"
              [disabled]="!isEditMode"
            >
              <option value="">Select Room</option>
              <option *ngFor="let r of roomTypeOptions" [value]="r.roomtypeid">
                {{ formatDropdownText(r.roomtype) }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label>Plan Type</label>
            <select
              formControlName="planType"
              class="form-control"
              [disabled]="!isEditMode"
            >
              <option value="">Select Plan</option>
              <option
                *ngFor="let s of planTypeOptions"
                [value]="s.paymentplanid"
              >
                {{ formatDropdownText(s.plantype) }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label>Enrollment Date</label>
            <input
              type="date"
              formControlName="enrollmentDate"
              class="form-control"
              [disabled]="!isEditMode"
            />
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="error-message-alert">
        {{ errorMessage }}
      </div>

      <!-- Success Message -->
      <div *ngIf="successMessage" class="success-message-alert">
        {{ successMessage }}
      </div>

      <!-- Action Buttons - Only visible in edit mode -->
      <div class="form-actions" *ngIf="isEditMode">
        <button
          type="button"
          class="btn-primary"
          (click)="onSaveChanges()"
          [disabled]="isSaving"
        >
          {{ isSaving ? "Saving..." : "Save Changes" }}
        </button>
        <button
          type="button"
          class="btn-secondary"
          (click)="onCancel()"
          [disabled]="isSaving"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>
